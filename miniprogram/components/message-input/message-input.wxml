<!-- 输入区域 -->
<view class="input-container w-full bg-white border-t border-gray-200 p-6 relative" style="padding-bottom: calc({{ bottomSafeHeight }}px);">

  <!-- 统一的输入模式容器 -->
  <view class="w-full flex flex-col gap-4 mb-4 border border-solid border-gray-300 bg-white rounded-2xl p-6">
    <!-- 输入模式切换区域 -->
    <view class="w-full flex items-center gap-3">
      <!-- 输入模式切换按钮 -->
      <button 
        class="btn-icon"
        bindtap="toggleInputMode"
      >
        <svg-icon wx:if="{{ !isVoiceMode }}" name="voice" size="40"></svg-icon>
        <svg-icon wx:if="{{ isVoiceMode }}" name="keyboard" size="40"></svg-icon>
      </button>
      
      <!-- 输入内容区域 -->
      <view class="flex-1">
        <!-- 文字输入框 -->
        <textarea
          wx:if="{{ !isVoiceMode }}"
          class="message-textarea w-full overflow-y-auto {{ textareaInitialHeight ? 'textarea-initial' : '' }}"
          placeholder="{{ isStreaming ? 'AI正在回复中...' : '你有什么想知道的，快来问问我' }}"
          value="{{ inputMessage }}"
          bindinput="onInputChange"
          bindconfirm="onConfirm"
          confirm-type="send"
          disabled="{{ isLoading }}"
          auto-height="{{ !textareaInitialHeight }}"
          maxlength="1000"
          show-confirm-bar="false"
          cursor-spacing="20"
          autofocus
        />
        
        <!-- 语音输入区域 -->
        <view wx:if="{{ isVoiceMode }}">
          <!-- 录音状态显示 -->
          <view class="voice-input-area" wx:if="{{ isRecording }}">
            <button 
              class="voice-button recording"
              disabled="{{ true }}"
            >
              录制中...
            </button>
          </view>
          
          <!-- 语音按钮 -->
          <view class="voice-input-area" wx:if="{{ !isRecording }}">
            <button 
              class="voice-button"
              bindtouchstart="startRecording"
              bindtouchend="stopRecording"
              bindtouchcancel="stopRecording"
              disabled="{{ isLoading }}"
            >
              按住说话
            </button>
          </view>
        </view>
      </view>
      
      <!-- 语音模式下的占位空间 -->
      <view wx:if="{{ isVoiceMode }}" style="width:36px"></view>
    </view>
    
    <!-- MCP 服务按钮 + 发送/停止按钮 -->
    <view class="w-full flex align-center justify-between">
      <view class="flex align-center gap-4">
        <button class="btn btn-tiny" catchtap="onOpenMcpSheet">
          <svg-icon name="server" size="40"></svg-icon>
          MCP 服务
        </button>
      </view>

      <view class="flex align-center gap-4">
        <button
          wx:if="{{ isLoading || isStreaming }}"
          class="btn-cancel btn btn-icon bg-black text-white"
          bindtap="onCancel"
        >
          <svg-icon name="stop" size="36" color="white"></svg-icon>
        </button>

        <button
          wx:elif="{{ !isLoading && !isStreaming }}"
          class="btn-send btn btn-icon bg-black text-white"
          bindtap="onSend"
          disabled="{{ !canSend }}"
        >
          <svg-icon name="send-fill" size="36" color="white"></svg-icon>
        </button>
      </view>
    </view>
  </view>
  
  <!-- 底部提示文字 -->
  <view class="text-center text-xs text-gray-400 leading-tight">
    内容由 AI 生成，仅供参考
  </view>

  <!-- MCP 选择抽屉 -->
  <bottom-sheet visible="{{ mcpSheetVisible }}" title="MCP 服务" bind:close="onCloseMcpSheet">
    <view class="mcp-list">
      <block wx:if="{{ mcpConfigs.length > 0 }}">
        <block wx:for="{{ mcpConfigs }}" wx:key="id">
          <view class="mcp-item">
            <view class="mcp-meta">
              <text class="mcp-name">{{ item.name }}</text>
              <view class="mcp-status">
                <view class="dot {{ item.isOnline ? 'online' : 'offline' }}"></view>
                <text class="status-text">{{ item.isOnline ? '在线' : '离线' }}</text>
              </view>
            </view>
            <switch class="mcp-switch" checked="{{ item.isEnabled }}" bindchange="onToggleMcp" data-id="{{ item.id }}"></switch>
          </view>
        </block>
      </block>
      <view class="mcp-empty" wx:else>
        <text>暂无 MCP 配置，可前往设置添加</text>
      </view>
    </view>
  </bottom-sheet>
</view>

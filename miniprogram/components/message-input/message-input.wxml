<!-- 输入区域 -->
<view class="input-container w-full bg-white border-t border-gray-200 p-6 relative" style="padding-bottom: calc({{ bottomSafeHeight }}px);">

  <!-- 文字输入模式 -->
  <view class="flex flex-col gap-4 mb-4 border border-solid border-gray-300 bg-white rounded-2xl p-6" wx:if="{{ !isVoiceMode }}">
    <view class="w-full">
      <textarea
        class="message-textarea w-full text-base overflow-y-auto"
        placeholder="{{ isStreaming ? 'AI正在回复中...' : '你有什么想知道的，快来问问我' }}"
        value="{{ inputMessage }}"
        bindinput="onInputChange"
        bindconfirm="onConfirm"
        confirm-type="send"
        disabled="{{ isLoading }}"
        auto-height="true"
        maxlength="1000"
        show-confirm-bar="false"
        cursor-spacing="20"
      />
    </view>
    <view class="w-full flex align-center justify-between">
      <view class="flex align-center gap-4">
        <!-- 输入模式切换按钮 -->
        <view class="mode-switch">
          <view 
            class="mode-tab {{ !isVoiceMode ? 'active' : '' }}" 
            bindtap="toggleInputMode"
            data-mode="text"
          >
            <text>文字</text>
          </view>
          <view 
            class="mode-tab {{ isVoiceMode ? 'active' : '' }}" 
            bindtap="toggleInputMode"
            data-mode="voice"
          >
            <text>语音</text>
          </view>
        </view>
        <button class="btn btn-tiny" catchtap="onOpenMcpSheet">
          <svg-icon name="server" size="32"></svg-icon>
          MCP 服务
        </button>
      </view>
    </view>
  </view>

  <!-- 语音输入模式 -->
  <view class="flex flex-col gap-4 mb-4 border border-solid border-gray-300 rounded-2xl p-6 bg-white" wx:if="{{ isVoiceMode }}">
    <view class="w-full">
      <!-- 录音状态显示 -->
      <view class="voice-input-area" wx:if="{{ isRecording }}">
        <button 
          class="voice-button recording"
          disabled="{{ true }}"
        >
          <text class="voice-button-text">录制中...</text>
        </button>
      </view>
      
      <!-- 语音按钮 - 替换输入框位置 -->
      <view class="voice-input-area" wx:if="{{ !isRecording }}">
        <button 
          class="voice-button"
          bindtouchstart="startRecording"
          bindtouchend="stopRecording"
          bindtouchcancel="stopRecording"
          disabled="{{ isLoading }}"
        >
          <text class="voice-button-text">按住说话</text>
        </button>
      </view>
    </view>
    <view class="w-full flex align-center justify-between">
      <view class="flex align-center gap-4">
        <!-- 输入模式切换按钮 -->
        <view class="mode-switch">
          <view 
            class="mode-tab {{ !isVoiceMode ? 'active' : '' }}" 
            bindtap="toggleInputMode"
            data-mode="text"
          >
            <text>文字</text>
          </view>
          <view 
            class="mode-tab {{ isVoiceMode ? 'active' : '' }}" 
            bindtap="toggleInputMode"
            data-mode="voice"
          >
            <text>语音</text>
          </view>
        </view>
        <button class="btn btn-tiny" catchtap="onOpenMcpSheet">
          <svg-icon name="server" size="32"></svg-icon>
          MCP 服务
        </button>
      </view>
    </view>
  </view>
  
  <!-- 底部提示文字 -->
  <view class="text-center text-xs text-gray-400 leading-tight">
    内容由 AI 生成，仅供参考
  </view>

  <!-- MCP 选择抽屉 -->
  <bottom-sheet visible="{{ mcpSheetVisible }}" title="MCP 服务" bind:close="onCloseMcpSheet">
    <view class="mcp-list">
      <block wx:if="{{ mcpConfigs.length > 0 }}">
        <block wx:for="{{ mcpConfigs }}" wx:key="id">
          <view class="mcp-item">
            <view class="mcp-meta">
              <text class="mcp-name">{{ item.name }}</text>
              <view class="mcp-status">
                <view class="dot {{ item.isOnline ? 'online' : 'offline' }}"></view>
                <text class="status-text">{{ item.isOnline ? '在线' : '离线' }}</text>
              </view>
            </view>
            <switch class="mcp-switch" checked="{{ item.isEnabled }}" bindchange="onToggleMcp" data-id="{{ item.id }}"></switch>
          </view>
        </block>
      </block>
      <view class="mcp-empty" wx:else>
        <text>暂无 MCP 配置，可前往设置添加</text>
      </view>
    </view>
  </bottom-sheet>
</view>

<!-- 聊天历史区域 -->
<scroll-view
  class="chat-scroll-view"
  scroll-y="true"
  scroll-top="{{ scrollTop }}"
  scroll-into-view="{{ scrollIntoView }}"
  bindscrolltoupper="onScrollToUpper"
  bindscrolltolower="onScrollToLower"
  upper-threshold="100"
  lower-threshold="60"
  enhanced="true"
  show-scrollbar="false"
>
  <view style="padding-top: {{ chatScrollTopPadding }}px;">
  <!-- 欢迎消息 -->
  <view wx:if="{{ messages.length === 0 }}" class="flex justify-center items-center h-full">
    <view class="rounded-2xl text-center welcome-container">
      <text class="welcome-title">欢迎使用</text>
      <text class="welcome-subtitle">有什么可以帮助你</text>
    </view>
  </view>

  <!-- 消息列表 - 直接在 scroll-view 中循环 -->
  <message-item
    wx:for="{{ messages }}"
    wx:key="index"
    message="{{ item }}"
    messageIndex="{{ index }}"
    isLast="{{ index === messages.length - 1 }}"
    isStreaming="{{ isStreaming }}"
    scrollViewHeight="{{ scrollViewHeight }}"
  />

  <!-- 加载状态（仅在非流式模式下显示） -->
  <message-item
    wx:if="{{ isLoading && !isStreaming }}"
    message="{{ emptyMessage }}"
    messageIndex="{{ -1 }}"
    isLast="{{ false }}"
    isStreaming="{{ false }}"
    isLoading="{{ true }}"
  />

  <!-- 加载更多指示器 -->
  <view wx:if="{{ isLoadingMore }}" class="load-more-indicator">
    <spin size="small" />
    <text class="load-more-text">加载更多消息...</text>
  </view>

  <!-- 没有更多消息提示 -->
  <view wx:if="{{ !hasMoreMessages && messages.length > 0 && !isLoadingMore }}" class="no-more-messages">
    <text class="no-more-text">没有更多消息了</text>
  </view>

  <!-- 底部占位符，确保最后一个消息有足够的显示空间 -->
  <view wx:if="{{ messages.length !== 0 }}" class="bottom-placeholder" style="height: 50vh;"></view>
  </view>
</scroll-view>

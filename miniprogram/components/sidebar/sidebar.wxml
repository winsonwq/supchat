<!-- 侧边栏遮罩层 -->
<view class="sidebar-mask {{isOpen ? 'sidebar-mask--open' : ''}}" bindtap="closeSidebar"></view>

<!-- 侧边栏主体 -->
<view class="sidebar {{isOpen ? 'sidebar--open' : ''}}" style="{{s.sidebarPaddingTop}}">
  <!-- 侧边栏头部 -->
  <view class="sidebar-header">
    <text class="sidebar-title">聊天记录</text>
  </view>

  <!-- 话题列表 -->
  <scroll-view class="sidebar-content" scroll-y="true">
    <view class="topics-list">
      <view 
        wx:for="{{topics}}" 
        wx:key="id" 
        class="topic-item {{currentTopicId === item.id ? 'topic-item--active' : ''}}"
        bindtap="selectTopic"
        data-id="{{item.id}}"
      >
        <view class="topic-title">{{item.title}}</view>
        <view class="topic-time">{{item.lastMessageTime}}</view>
      </view>
      
      <!-- 空状态 -->
      <view wx:if="{{topics.length === 0}}" class="empty-state">
        <text class="empty-text">暂无聊天记录</text>
      </view>
    </view>
  </scroll-view>

  <!-- 新建话题按钮 -->
  <view class="sidebar-footer">
    <button class="new-topic-btn" bindtap="createNewTopic">
      <svg-icon name="plus" size="32" color="white" class="new-topic-icon"></svg-icon>
      <text class="new-topic-text">新建话题</text>
    </button>
  </view>

  <!-- 底部用户栏 -->
  <view class="sidebar-bottom-bar">
    <view class="user-info" bindtap="showUserMenu">
      <view class="user-avatar" bindtap="showUserMenu">
        <!-- 如果有头像URL，显示图片 -->
        <image wx:if="{{localUserInfo && localUserInfo.avatar}}" 
               src="{{localUserInfo.avatar}}" 
               class="avatar-image"
               mode="aspectFill" />
        <!-- 否则显示文字头像 -->
        <text wx:else class="avatar-text">{{localUserInfo && localUserInfo.name ? localUserInfo.name.charAt(0) : 'U'}}</text>
      </view>
      <view class="user-name-wrapper" bindtap="showUserMenu">
        <text class="user-name">{{localUserInfo && localUserInfo.name || '点击设置昵称'}}</text>
        <text wx:if="{{!localUserInfo || !localUserInfo.isAuthorized}}" class="auth-hint">未授权</text>
      </view>
    </view>
    <button class="settings-btn" bindtap="openSettings">
      <svg-icon name="settings" size="36" color="gray" class="settings-icon"></svg-icon>
    </button>
  </view>
</view>

<!--agent-edit.wxml-->
<view class="page" style="padding-top: {{contentPaddingTop}}px;">
  <navigation-bar title="编辑AI助手" show-back="{{true}}"></navigation-bar>
  
  <view class="content">
    <form class="form">
      <!-- 基本信息 -->
      <view class="form-section">
        <view class="section-title">基本信息</view>
        
        <form-input
          label="配置名称"
          placeholder="请输入AI助手名称"
          value="{{form.name}}"
          error="{{errors.name}}"
          bind:input="onInputChange"
          data-field="name"
        />
        
        <form-input
          label="描述（可选）"
          placeholder="请输入AI助手的描述信息"
          value="{{form.description}}"
          error="{{errors.description}}"
          bind:input="onInputChange"
          data-field="description"
        />
      </view>

      <!-- 系统提示词 -->
      <view class="form-section">
        <view class="section-title">系统提示词</view>
        
        <view class="textarea-container">
          <view class="textarea-label">提示词内容</view>
          <textarea
            class="textarea"
            placeholder="请输入系统提示词，这将决定AI助手的行为和回答风格..."
            value="{{form.systemPrompt}}"
            bindinput="onTextareaChange"
            data-field="systemPrompt"
            maxlength="2000"
            show-confirm-bar="{{false}}"
          />
          <view class="textarea-counter">{{form.systemPrompt.length}}/2000</view>
          <view wx:if="{{errors.systemPrompt}}" class="error-text">{{errors.systemPrompt}}</view>
        </view>
      </view>

      <!-- MCP服务器配置 -->
      <view class="form-section">
        <view class="section-title">MCP服务器配置</view>
        <view class="section-desc">配置AI助手可以使用的MCP服务器（JSON格式）</view>
        
        <view class="example-config">
          <view class="example-title">示例配置：</view>
          <view class="example-content">[
  {
    "id": "server1",
    "name": "文件系统",
    "url": "http://localhost:3001/api/servers/filesystem/mcp",
    "authType": "none",
    "authConfig": {},
    "isEnabled": true
  }
]</view>
        </view>
        
        <view class="textarea-container">
          <view class="textarea-label">MCP服务器配置</view>
          <textarea
            class="textarea json-textarea"
            placeholder='请输入MCP服务器配置JSON，参考上方示例格式'
            value="{{form.mcpServersJson}}"
            bindinput="onTextareaChange"
            data-field="mcpServersJson"
            maxlength="5000"
            show-confirm-bar="{{false}}"
          />
          <view class="textarea-counter">{{form.mcpServersJson.length}}/5000</view>
          <view wx:if="{{errors.mcpServersJson}}" class="error-text">{{errors.mcpServersJson}}</view>
        </view>
      </view>

      <!-- 配置信息 -->
      <view class="form-section">
        <view class="section-title">配置信息</view>
        
        <view class="config-info">
          <view class="info-item">
            <text class="info-label">配置ID：</text>
            <text class="info-value">{{configId}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">创建时间：</text>
            <text class="info-value">{{configInfo.createdAtText}}</text>
          </view>
          <view class="info-item">
            <text class="info-label">最后更新：</text>
            <text class="info-value">{{configInfo.updatedAtText}}</text>
          </view>
        </view>
      </view>
    </form>
  </view>

  <!-- 底部操作栏 -->
  <view class="bottom-actions" style="padding-bottom: calc(32rpx + {{bottomSafeHeight}}px);">
    <button class="btn btn-secondary" bindtap="onTestConfig">测试配置</button>
    <button class="btn btn-primary" bindtap="onSave" disabled="{{!canSave}}">保存修改</button>
  </view>
</view>
